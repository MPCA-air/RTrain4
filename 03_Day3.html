<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>R Training | Day 3</title>

<script src="03_Day3_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="03_Day3_files/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="03_Day3_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="03_Day3_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="03_Day3_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="03_Day3_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="03_Day3_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="03_Day3_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="03_Day3_files/navigation-1.1/tabsets.js"></script>
<link href="03_Day3_files/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="03_Day3_files/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="css\camp_style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">R Training | Day 3</h1>

</div>


<div id="welcome-back-jedis" class="section level1 unnumbered">
<h1>Welcome back Jedis!</h1>
<hr>
<div class="figure">
<img src="images/day3_sq.png" style="float: left; margin-right: 60px; margin-top: 8px;" width="260" />

</div>
<p><br></p>
<div id="open-your-rstudio-project" class="section level3 unnumbered">
<h3>Open your RStudio project</h3>
<ul>
<li><strong>Open</strong> your project folder from last week</li>
<li>Double click the <strong>.Rproj</strong> file to open RStudio</li>
</ul>
<p><strong>Open a New script</strong></p>
<ul>
<li><p><strong>File &gt; New File &gt; R Script</strong></p></li>
<li>Click the <em>floppy disk</em> save icon</li>
<li><p>Give it a name: <code>03_day.R</code> will work well</p></li>
</ul>
</div>
<div id="schedule" class="section level2 unnumbered">
<h2>Schedule</h2>
<div class="well">
<ul>
<li>Review</li>
<li>Working with <i class="fa fa-calendar" aria-hidden="true"></i> <strong>dates</strong> - Endor Storm Chasing</li>
<li>The magic <strong>pipe</strong> <code>%&gt;%</code></li>
<li>Where’s Finn?</li>
<li>Join 2 tables: <code>left_join</code> to the rescue</li>
<li>Calculate summary stats for your <strong>entire table</strong></li>
<li><code>group_by</code>: Calculate stats for each group and category (for each monitoring site, each pollutant, each year, or every thingymajig in your data)</li>
<li><strong>Save</strong> <strong>&amp;</strong> <strong>Export</strong> data</li>
</ul>
</div>
</div>
<div id="porg-review" class="section level2 unnumbered">
<h2>Porg review</h2>
<p>The <em>poggle</em> of porgs has returned to help us review the <code>dplyr</code> functions. Follow along by downloading the <strong>porg</strong> data from the URL below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
porgs &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://itep-r.netlify.com/data/porg_data.csv&quot;</span>)</code></pre></div>
<p><br></p>
<ul class="nav nav-pills" id="myTab" role="tablist" style="margin-top: 18px;">
<li class="nav-item active">
<a class="nav-link" id="porgs-tab" data-toggle="tab" href="#porgs" role="tab" aria-controls="porgs" aria-selected="true"> porgs </a>
</li>
<li class="nav-item">
<a class="nav-link" id="select-tab" data-toggle="tab" href="#select" role="tab" aria-controls="select" aria-selected="false"> <code>select</code> </a>
</li>
<li class="nav-item">
<a class="nav-link" id="arrange-tab" data-toggle="tab" href="#arrange" role="tab" aria-controls="arrange" aria-selected="false"> <code>arrange</code></a>
</li>
<li class="nav-item">
<a class="nav-link" id="filter-tab" data-toggle="tab" href="#filter" role="tab" aria-controls="filter" aria-selected="false"> <code>filter</code></a>
</li>
<li class="nav-item">
<a class="nav-link" id="mutate3-tab" data-toggle="tab" href="#mutate3" role="tab" aria-controls="mutate3" aria-selected="false"> <code>mutate</code></a>
</li>
<li class="nav-item">
<a class="nav-link" id="summarize-tab" data-toggle="tab" href="#summarize" role="tab" aria-controls="summarize" aria-selected="false"> <code>summarize</code></a>
</li>
<li class="nav-item">
<a class="nav-link" id="group_by-tab" data-toggle="tab" href="#group_by" role="tab" aria-controls="group_by" aria-selected="false"> <code>group_by</code></a>
</li>
</ul>
<div id="myTabContent" class="well tab-content" style="background-color: white;">
<div id="porgs" class="tab-pane fade active in" role="tabpanel" aria-labelledby="porgs-tab">
<img src="images/porgs/porgs_tbl.png" style="width: 85%;" /> <br><br>
</div>
<div id="select" class="tab-pane fade" role="tabpanel" aria-labelledby="select-tab">
<img src="images/porgs/select_card.png" style="width: 90%;" /> <br><br> <img src="images/porgs/select_drop.png" style="width: 65%;" /> <img src="images/porgs/select_drop_tbl.png" style="width: 80%; margin-left: 5%; margin-top: 12px;" /> <br><br>
</div>
<div id="arrange" class="tab-pane fade" role="tabpanel" aria-labelledby="arrange-tab">
<img src="images/porgs/arrange.png" style="width: 65%;" /> <img src="images/porgs/arrange_tbl.png" style="width: 88%; margin-left: 10%; margin-top: 12px;" /> <br><br> <img src="images/porgs/arrange_desc.png" style="width: 57%;" /> <img src="images/porgs/arrange_tbl_desc.png" style="width: 88%; margin-left: 10%; margin-top: 12px;" /> <br><br>
</div>
<div id="filter" class="tab-pane fade" role="tabpanel" aria-labelledby="filter-tab">
<img src="images/porgs/filter.png" style="width: 65%;" /> <img src="images/porgs/filter_tbl.png" style="width: 88%; margin-left: 10%; margin-top: 12px;" /> <br><br> <img src="images/porgs/filter2.png" style="width: 75%;" /> <img src="images/porgs/filter2_tbl.png" style="width: 88%; margin-left: 10%; margin-top: 12px;" /> <br><br>
</div>
<div id="mutate3" class="tab-pane fade" role="tabpanel" aria-labelledby="mutate3-tab">
<img src="images/porgs/mutate_card.png" style="width: 88%;" /> <br><br>
</div>
<div id="summarize" class="tab-pane fade" role="tabpanel" aria-labelledby="summarize-tab">
<img src="images/porgs/summarize_card.png" style="width: 88%;" /> <br><br>
</div>
<div id="group_by" class="tab-pane fade" role="tabpanel" aria-labelledby="group_by-tab">
<img src="images/porgs/groupby_card.png" style="width: 92%;" /> <br><br>
</div>
</div>
<p><br></p>
</div>
</div>
<div id="new-mission" class="section level1 unnumbered">
<h1>New mission!</h1>
<hr>
<p>BB8 received new data from the wookies suggesting there was a large magnetic storm just before <code>Site 1</code> burned down on Endor. Sounds like we’re going to be <strong>STORM CHASERS</strong>!</p>
<p><strong>Get the dataset</strong></p>
<p>While we’re relaxing and flying to Endor let’s get set up with our new data.</p>
<p><br></p>
<p><strong>Endor Setup</strong></p>
<ol style="list-style-type: decimal">
<li>Download the data.
<ul>
<li><a href="https://itep-r.netlify.com/data/air_endor.csv"><span class="btn_code_blue" style="margin-bottom: 10px; margin-top: 12px;"> <strong>DOWNLOAD</strong> </span></a> - Get the Endor monitoring data</li>
</ul></li>
<li>Create a new folder called <code>data</code> in your project folder.</li>
<li>Move the downloaded Endor file to there.</li>
<li>Create a new R script called <code>endor.R</code></li>
</ol>
<p>Now we can read in the data from the data folder with our favorite <code>read_csv</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(janitor)

air_endor &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/air_endor.csv&quot;</span>)

<span class="kw">names</span>(air_endor)

<span class="co"># Clean the column names</span>
air_endor &lt;-<span class="st"> </span><span class="kw">clean_names</span>(air_endor)

<span class="kw">names</span>(air_endor)</code></pre></div>
<pre><code>## [1] &quot;analyte&quot;        &quot;lab_code&quot;       &quot;units&quot;          &quot;start_run_date&quot;
## [5] &quot;site_name&quot;      &quot;long_site_name&quot; &quot;planet&quot;         &quot;result&quot;</code></pre>
<p><br></p>
<div class="tip">
<h3 id="note">Note</h3>
<p>When your project is open, RStudio sets the working directory to your project folder. When reading files from a folder outside of your project, you’ll need to use the full file path location.</p>
<p>For example, for a file on the <strong>X-drive</strong>: <code>X://Programs/Air_Quality/Ozone_data.csv</code> <br></p>
</div>
</div>
<div id="welcome-to-endor" class="section level1 unnumbered">
<h1>Welcome to Endor!</h1>
<div class="figure">
<img src="https://itep-r.netlify.com/images/planet_endor.jpg" style="width: 75%; margin-top: -4px; margin-left: 11%;" />

</div>
<p><br></p>
<p><strong>Let’s get acquainted with our new Endor data set.</strong></p>
<blockquote>
<p>Remember the different ways?</p>
<p><em>Hint:</em> <code>summary()</code>, <code>glimpse()</code>, <code>nrow()</code>, <code>distinct()</code></p>
</blockquote>
<p><br></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(air_endor)</code></pre></div>
<pre><code>## Observations: 1,190
## Variables: 8
## $ analyte        &lt;chr&gt; &quot;1-Methylnaphthalene&quot;, &quot;1-Methylnaphthalene&quot;, &quot;...
## $ lab_code       &lt;chr&gt; &quot;HV-403&quot;, &quot;HV-408&quot;, &quot;HV-411&quot;, &quot;HV-415&quot;, &quot;HV-418...
## $ units          &lt;chr&gt; &quot;ng/m3&quot;, &quot;ng/m3&quot;, &quot;ng/m3&quot;, &quot;ng/m3&quot;, &quot;ng/m3&quot;, &quot;n...
## $ start_run_date &lt;chr&gt; &quot;7/11/2016&quot;, &quot;7/23/2016&quot;, &quot;8/5/2016&quot;, &quot;8/16/201...
## $ site_name      &lt;chr&gt; &quot;battlesite1&quot;, &quot;battlesite1&quot;, &quot;battlesite1&quot;, &quot;b...
## $ long_site_name &lt;chr&gt; &quot;Endor_Tana_forestmoon_battlesite1&quot;, &quot;Endor_Tan...
## $ planet         &lt;chr&gt; &quot;Endor&quot;, &quot;Endor&quot;, &quot;Endor&quot;, &quot;Endor&quot;, &quot;Endor&quot;, &quot;E...
## $ result         &lt;dbl&gt; 0.00291, 0.00000, 0.00000, 0.00608, 0.00000, 0....</code></pre>
<p><br></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">distinct</span>(air_endor, analyte)</code></pre></div>
<pre><code>## # A tibble: 27 x 1
##    analyte             
##    &lt;chr&gt;               
##  1 1-Methylnaphthalene 
##  2 2-Methylnaphthalene 
##  3 5-Methylchrysene    
##  4 Acenaphthene        
##  5 Anthanthrene        
##  6 Benz[a]anthracene   
##  7 Benzo[a]pyrene      
##  8 Benzo[c]fluorene    
##  9 Benzo[e]pyrene      
## 10 Benzo[g,h,i]perylene
## # ... with 17 more rows</code></pre>
<p><br></p>
<p><strong>Woah. There are definitely more analytes than we need. We only want to know about <code>magnetic_field</code> data. Let’s filter down to only that analyte.</strong></p>
<p><br></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mag_endor &lt;-<span class="st"> </span><span class="kw">filter</span>(air_endor, analyte <span class="op">==</span><span class="st"> &quot;magnetic_field&quot;</span>)</code></pre></div>
<p><br></p>
<p><strong>Boom!</strong> How many rows are left now?</p>
<p><br></p>
<p><strong>How do we filter on the date column?</strong></p>
<p><br></p>
<div class="well">
<p>With time series data it’s helpful for R to know which columns are <strong>date</strong> columns. Dates come in many formats and the standard format in R is <code>2019-01-15</code>, also referred to as <em>Year-Month-Day</em> format.</p>
<p>We use the <code>lubridate</code> package to help format our dates.</p>
</div>
</div>
<div id="dates" class="section level1">
<h1><span class="header-section-number">1</span> | <i class="fa fa-calendar" aria-hidden="true"></i> Dates</h1>
<hr>
<div id="the-lubridate-package" class="section level3 unnumbered">
<h3>The <code>lubridate</code> package</h3>
<div class="figure">
<img src="images/lubridate.png" style="width: 21%; float: left; margin-right: 30px; margin-top: 8px; margin-bottom: 12px;" />

</div>
<p><br></p>
<p>It’s about time! Lubridate makes working with dates much easier.</p>
<p>We can find how much time has elapsed, add or subtract days, and find seasonal and day of the week averages.</p>
<p><br></p>
<div style="clear: both;">

</div>
<p><br></p>
</div>
<div id="convert-text-to-a-date" class="section level3 unnumbered">
<h3>Convert text to a <em>DATE</em></h3>
<table>
<thead>
<tr class="header">
<th>Function</th>
<th align="left">Order of date elements</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>mdy()</code></td>
<td align="left">Month-Day-Year :: <code>05-18-2019</code> or <code>05/18/2019</code></td>
</tr>
<tr class="even">
<td><code>dmy()</code></td>
<td align="left">Day-Month-Year (Euro dates) :: <code>18-05-2019</code> or <code>18/05/2019</code></td>
</tr>
<tr class="odd">
<td><code>ymd()</code></td>
<td align="left">Year-Month-Day (science dates) :: <code>2019-05-18</code> or <code>2019/05/18</code></td>
</tr>
<tr class="even">
<td><code>ymd_hm()</code></td>
<td align="left">Year-Month-Day Hour:Minutes :: <code>2019-05-18 8:35 AM</code></td>
</tr>
<tr class="odd">
<td><code>ymd_hms()</code></td>
<td align="left">Year-Month-Day Hour:Minutes:Seconds :: <code>2019-05-18 8:35:22 AM</code></td>
</tr>
</tbody>
</table>
<p><br></p>
</div>
<div id="get-date-parts" class="section level3 unnumbered">
<h3>Get date parts</h3>
<table>
<thead>
<tr class="header">
<th>Function</th>
<th align="left">Date element</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>year()</code></td>
<td align="left">Year</td>
</tr>
<tr class="even">
<td><code>month()</code></td>
<td align="left">Month as <em>1,2,3</em>; For <em>Jan, Feb, Mar</em> use <code>label=TRUE</code></td>
</tr>
<tr class="odd">
<td><code>day()</code></td>
<td align="left">Day of the month</td>
</tr>
<tr class="even">
<td><code>wday()</code></td>
<td align="left">Day of the week as <em>1,2,3</em>; For <em>Sun, Mon, Tue</em> use <code>label=TRUE</code></td>
</tr>
<tr class="odd">
<td><em>- Time -</em></td>
<td align="left"></td>
</tr>
<tr class="even">
<td><code>hour()</code></td>
<td align="left">Hour of the day <em>(24hr)</em></td>
</tr>
<tr class="odd">
<td><code>minute()</code></td>
<td align="left">Minutes</td>
</tr>
<tr class="even">
<td><code>second()</code></td>
<td align="left">Seconds</td>
</tr>
<tr class="odd">
<td><code>tz()</code></td>
<td align="left">Time zone</td>
</tr>
</tbody>
</table>
<p><br></p>
</div>
<div id="install-lubridate" class="section level2 unnumbered">
<h2>Install <code>lubridate</code></h2>
<p>First, type or copy and paste <code>install.packages(&quot;lubridate&quot;)</code> into RStudio.</p>
</div>
<div id="clean-the-dates" class="section level2 unnumbered">
<h2><i class="fa fa-broom" aria-hidden="true"></i> Clean the dates</h2>
<p>Let’s use the <code>mdy()</code> function to turn the <code>start_run_date</code> column into a nicely formatted date.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lubridate)

mag_endor &lt;-<span class="st"> </span><span class="kw">mutate</span>(mag_endor, <span class="dt">date =</span> <span class="kw">mdy</span>(start_run_date),
                               <span class="dt">year =</span> <span class="kw">year</span>(date))</code></pre></div>
<p><br></p>
<p><strong>According to the request we received, the Resistance is only interested in observations from the year <code>2017</code>. So let’s filter the data down to only dates within that year.</strong></p>
<p><br></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mag_endor &lt;-<span class="st"> </span><span class="kw">filter</span>(mag_endor, year <span class="op">==</span><span class="st"> &quot;2017&quot;</span>)</code></pre></div>
</div>
<div id="time-series" class="section level2 unnumbered">
<h2>Time series</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mag_endor, <span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> result)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;tomato&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">5</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)  <span class="co"># alpha changes transparency</span></code></pre></div>
<p><img src="03_Day3_files/figure-html/endor-time-1.png" width="1056" /></p>
<p>Looks like the measurements definitely picked up a signal towards the end of the year. Let’s make a different chart to show when this occurred.</p>
<p><br></p>
<div class="note">
<h3 id="mission-complete" class="unnumbered">Mission complete!</h3>
<p>Aha! There really was a spike in the magnetic field in November. Hopefully, the <em>Resistance</em> will reward us handsomely for this information.</p>
</div>
</div>
</div>
<div id="the-pipe-operator" class="section level1">
<h1><span class="header-section-number">2</span> | The pipe operator</h1>
<blockquote>
<p><strong>I wish I could type the name of the data frame less often. </strong></p>
</blockquote>
<p><br></p>
<div class="figure">
<img src="images/pipe.png" style="margin-right: 20px; width: 136px; float: left;" />

</div>
<p><strong>Now you can!</strong></p>
<p>We use the <code>%&gt;%</code> to chain functions together and make our scripts more streamlined. We call it the <em>pipe</em>.</p>
<p><br></p>
<div style="clear: both;">

</div>
<p>Here are 2 examples of how the <code>%&gt;%</code> operator is helpful.</p>
<p><br></p>
<p><strong><code>#1:</code></strong> It eliminates the need for nested parentheses.</p>
<p>Say you wanted to take the sum of 3 numbers and then take the log and then round the final result.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">round</span>(<span class="kw">log</span>(<span class="kw">sum</span>(<span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>))))</code></pre></div>
<p><br></p>
<p>The code doesn’t look much like the words we used to describe it. Let’s pipe it so we can read the code from left to right.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">50</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sum</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">log10</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>()</code></pre></div>
<p><br></p>
<p><strong><code>#2:</code></strong> We can combine many processing steps into one cohesive chunk.</p>
<p><br></p>
<p>Here are some of the functions we’ve applied to the scrap data so far:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scrap &lt;-<span class="st"> </span><span class="kw">arrange</span>(scrap, <span class="kw">desc</span>(price_per_pound))

scrap &lt;-<span class="st"> </span><span class="kw">filter</span>(scrap, origin <span class="op">!=</span><span class="st"> &quot;All&quot;</span>)

scrap &lt;-<span class="st"> </span><span class="kw">mutate</span>(scrap, 
                <span class="dt">scrap_finder    =</span> <span class="st">&quot;BB8&quot;</span>,
                <span class="dt">measure_method  =</span> <span class="st">&quot;REM-24&quot;</span>)</code></pre></div>
<p><br></p>
<p>We can use the <code>%&gt;%</code> operator and write it this way.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scrap &lt;-<span class="st"> </span>scrap <span class="op">%&gt;%</span>
<span class="st">           </span><span class="kw">arrange</span>(<span class="kw">desc</span>(price_per_pound)) <span class="op">%&gt;%</span>
<span class="st">           </span><span class="kw">filter</span>(origin <span class="op">!=</span><span class="st"> &quot;All&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">           </span><span class="kw">mutate</span>(<span class="dt">scrap_finder    =</span> <span class="st">&quot;BB8&quot;</span>,
                  <span class="dt">measure_method  =</span> <span class="st">&quot;REM-24&quot;</span>)</code></pre></div>
<p><br></p>
<div class="tip">
<h3 id="exercise" class="unnumbered"><i class="fa fa-bicycle" aria-hidden="true" style="color: green"></i> EXERCISE</h3>
<p>Similar to above, use the <code>%&gt;%</code> to combine the two Endor lines below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Filter to only magnetic_field measurements</span>
mag_endor &lt;-<span class="st"> </span><span class="kw">filter</span>(air_endor, analyte <span class="op">==</span><span class="st"> &quot;magnetic_field&quot;</span>)

<span class="co"># Add a date column to the filtered data</span>
mag_endor &lt;-<span class="st"> </span><span class="kw">mutate</span>(mag_endor, <span class="dt">date =</span> <span class="kw">mdy</span>(start_run_date))</code></pre></div>
</div>
<p><br></p>
<blockquote>
<p><strong>So where were we?</strong></p>
<p><strong>Oh right, we we’re enjoying our time on beautiful lush Endor. Aren’t we missing somebody…?</strong></p>
</blockquote>
</div>
<div id="finn-needs-us" class="section level1 unnumbered">
<h1>| Finn needs us!</h1>
<p>That’s enough <em>scuttlebutting</em> around on Endor, Finn needs us back on Jakku. It turns out we forgot to pick-up Finn when we left. Now he’s being held ransom by Junk Boss Plutt. We’ll need to act fast to get to him before the Empire does. <strong>Blast off!</strong></p>
<p><br></p>
<div class="figure">
<img src="images/finn_run.gif" style="margin-left: 18%; width: 60%; margin-top: 6px;" />

</div>
<p><br></p>
</div>
<div id="more-data" class="section level1 unnumbered">
<h1>More data</h1>
<div class="tip">
<h3 style="margin-top: 13px;">
Update from BB8!
</h3>
<p>BB8 was busy on our flight back to Jakku, and was able to recover a <strong>full</strong> set of scrap records from the notorious Unkar Plutt. Let’s take a look.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
<span class="kw">library</span>(dplyr)

<span class="co"># Read in the full scrap database</span>
scrap &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://itep-r.netlify.com/data/starwars_scrap_jakku_full.csv&quot;</span>)</code></pre></div>
</div>
<p><br></p>
</div>
<div id="jakku-re-visited" class="section level1">
<h1><span class="header-section-number">3</span> | Jakku re-visited</h1>
<hr>
<p>Okay, so we’re back on this ol’ dust bucket. Let’s try not to forget anything this time. We’re quickly running out of friends on this planet.</p>
<div id="a-scrappy-ransom" class="section level2 unnumbered">
<h2>A scrappy ransom</h2>
<p>Mr. Baddy Plutt is demanding <strong>10,000 items</strong> of scrap for Finn. Sounds expensive, but lucky for us he didn’t clarify the exact items. Let’s find the scrap that weighs the least per shipment and try to make this transaction as light as possible.</p>
<p>Take a look at our <strong>NEW</strong> scrap data and see if we have the weight of all the items.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># What unit types are in the data?</span>
<span class="kw">unique</span>(scrap<span class="op">$</span>units)</code></pre></div>
<pre><code>## [1] &quot;Cubic Yards&quot; &quot;Items&quot;       &quot;Tons&quot;</code></pre>
<p><br></p>
<p><strong>Or return results as a data frame</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">distinct</span>(scrap, units)</code></pre></div>
<pre><code>## # A tibble: 3 x 1
##   units      
##   &lt;chr&gt;      
## 1 Cubic Yards
## 2 Items      
## 3 Tons</code></pre>
<p><br></p>
<p><em>Hmmm….</em> So how much does a cubic yard of <code>Hull Panel</code> weigh?</p>
<p><em>A lot? 32? Maybe…</em></p>
<p>I think we’re going to need some more data.</p>
<p><br></p>
<div class="tip">
<p><br></p>
<p><strong>“Hey BB8!”</strong></p>
<p><strong>“Do your magic data finding thing.”</strong></p>
</div>
</div>
<div id="weight-conversion" class="section level2 unnumbered">
<h2>Weight conversion</h2>
<div class="figure">
<img src="images/rey_bb8.jpg" align="right" style="width: 35%; margin-top: 0px; margin-left: 15px; margin-right: 0px;" />

</div>
<p>It took a while, but with a few droid bribes BB8 was able to track down a <em>Weight conversion table</em> from his old droid buddies. Our current data shows the total cubic yards for some scrap shipments, but not how much the shipment weighs.</p>
<div id="read-the-weight-conversion-table" class="section level3 unnumbered">
<h3>Read the weight conversion table</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The data&#39;s URL</span>
convert_url &lt;-<span class="st"> &quot;https://rtrain.netlify.com/data/conversion_table.csv&quot;</span>

<span class="co"># Read the conversion data</span>
convert &lt;-<span class="st"> </span><span class="kw">read_csv</span>(convert_url)

<span class="kw">head</span>(convert, <span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   item               units       pounds_per_unit
##   &lt;chr&gt;              &lt;chr&gt;                 &lt;dbl&gt;
## 1 Bulkhead           Cubic Yards             321
## 2 Hull Panel         Cubic Yards             641
## 3 Repulsorlift array Cubic Yards             467</code></pre>
<p><br></p>
<p>Stars! A cubic yard of <code>Hull Panel</code> weighs <strong>641 lbs</strong>. That’s what I thought!</p>
<p>Let’s join this new conversion table to the scrap data to make our calculations easier. To do that we need to make a new friend.</p>
<p><strong>Say “Hello” to <code>left_join()</code>!</strong></p>
</div>
</div>
</div>
<div id="join-tables" class="section level1">
<h1><span class="header-section-number">4</span> | Join tables</h1>
<hr>
<div class="figure">
<img src="images/leftjoin_scrap.png" style="width: 55%; margin-left: 18%;" />

</div>
<p><br><br><br></p>
<p><code>left_join()</code> works like a zipper and combines two tables based on one or more variables. It’s called “left”-join because the entire table on the left side is retained. Anything that matches from the right table gets to join the party, but the rest will be ignored.</p>
<div id="join-2-tables" class="section level2 unnumbered">
<h2>Join 2 tables</h2>
<div id="left_jointable1-table2-by-ccolumns-to-join-by" class="section level3 unnumbered">
<h3><code>left_join(table1, table2, by = c(&quot;columns to join by&quot;))</code></h3>
<p><br></p>
</div>
<div id="adding-porg-names" class="section level3 unnumbered">
<h3>Adding porg names</h3>
<p>Remember our porg friends? How rude of us not to share their names. <strong>Wups!</strong></p>
<p>Here they are:</p>
<div style="margin-left: 10px; margin-top: 24px; width: 37%; margin-bottom: 34px;">
<div class="figure">
<img src="images/porgs/porg_names_tbl.png" />

</div>
</div>
<div style="clear: both;">

</div>
<p><strong>Hey now!</strong> That’s not very helpful. Who’s who? Let’s join their names to the rest their data.</p>
<p><br></p>
<div class="figure">
<img src="images/porgs/porg_join.png" style="width: 85%;" />

</div>
<p><br></p>
</div>
<div id="the-result" class="section level3 unnumbered">
<h3><strong>The result</strong></h3>
<div class="well">
<div class="figure">
<img src="images/porgs/porgs_and_names.png" style="width: 85%; max-width: 85%;" />

</div>
</div>
<p><br></p>
</div>
</div>
<div id="back-to-scrap-land" class="section level2 unnumbered">
<h2>Back to scrap land</h2>
<p>Let’s apply our new <code>left_join()</code> skills to the scrap data.</p>
<p><br></p>
<div id="join-the-conversion-table-to-the-scrap" class="section level3 unnumbered">
<h3>Join the conversion table to the scrap</h3>
<p>Look at the tables. What columns in both tables do we want to join <strong>by</strong>?</p>
<p><br></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scrap &lt;-<span class="st"> </span><span class="kw">left_join</span>(scrap, convert, 
                   <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;item&quot;</span> =<span class="st"> &quot;item&quot;</span>, <span class="st">&quot;units&quot;</span> =<span class="st"> &quot;units&quot;</span>))</code></pre></div>
<p><br></p>
<blockquote>
<p>Want to skimp on typing?</p>
</blockquote>
<p><br></p>
<p>When the 2 tables share column names that are the same, <code>left_join()</code> will automatically search for matching columns. Nice! So the code below does the same as above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scrap &lt;-<span class="st"> </span><span class="kw">left_join</span>(scrap, convert)

<span class="kw">head</span>(scrap, <span class="dv">4</span>)</code></pre></div>
<pre><code>## # A tibble: 4 x 8
##   receipt_date item  origin destination amount units price_per_pound
##   &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
## 1 4/1/2013     Bulk~ Crate~ Raiders       4017 Cubi~           1005.
## 2 4/2/2013     Star~ Outsk~ Trade cara~   1249 Cubi~           1129.
## 3 4/3/2013     Star~ Outsk~ Niima Outp~   4434 Cubi~           1129.
## 4 4/4/2013     Hull~ Crate~ Raiders        286 Cubi~            843.
## # ... with 1 more variable: pounds_per_unit &lt;dbl&gt;</code></pre>
<p><br></p>
<p><strong>Want more details?</strong></p>
<p>You can type <code>?left_join</code> to see all the arguments and options.</p>
<p><br></p>
</div>
</div>
<div id="total-pounds-per-shipment" class="section level2 unnumbered">
<h2>Total pounds per shipment</h2>
<p>Let’s <code>mutate()</code>!</p>
<p>Now that we have pounds per unit we can use <code>mutate</code> to calculate the total pounds for each shipment.</p>
<p><br></p>
<p><strong>Fill in the blank</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scrap &lt;-<span class="st"> </span>scrap <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">         </span><span class="kw">mutate</span>(<span class="dt">total_pounds =</span> amount <span class="op">*</span><span class="st">  </span>_____________ )</code></pre></div>
<details> <summary class = "btn_code"><em>Show code</em></summary>
<p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scrap &lt;-<span class="st"> </span>scrap <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">         </span><span class="kw">mutate</span>(<span class="dt">total_pounds =</span> amount <span class="op">*</span><span class="st"> </span>pounds_per_unit)</code></pre></div>
</p>
<p></details></p>
</div>
<div id="total-price-per-shipment" class="section level2 unnumbered">
<h2>Total price per shipment</h2>
<div class="tip">
<h3 id="exercise-1" class="unnumbered"><i class="fa fa-bicycle" aria-hidden="true" style="color: green"></i> EXERCISE</h3>
<ul class="nav nav-pills" id="myTab" role="tablist" style="margin-top: 18px;">
<li class="nav-item active">
<a class="nav-link" id="totalprice-tab" data-toggle="tab" href="#totalprice" role="tab" aria-controls="totalprice" aria-selected="true">Total price</a>
</li>
<li class="nav-item">
<a class="nav-link" id="showhint-tab" data-toggle="tab" href="#showhint" role="tab" aria-controls="showhint" aria-selected="false">Show hint</a>
</li>
<li class="nav-item">
<a class="nav-link" id="showcode-tab" data-toggle="tab" href="#showcode" role="tab" aria-controls="showcode" aria-selected="false">Show code</a>
</li>
</ul>
<div id="myTabContent" class="well tab-content" style="background-color: white;">
<div id="totalprice" class="tab-pane fade active in" role="tabpanel" aria-labelledby="totalprice-tab">
<h4>
Total price
</h4>
<p>We need to do some serious multiplication. We now have the total amount shipped in pounds, and the price per pound, but we want to know the total price for each transaction.</p>
<p>How do we calculate that?</p>
<pre class="sourceCode r">
# Calculate the total price for each shipment
scrap <- scrap %>% 
         mutate(credits = ________ * ________ )
         
</pre>
</div>
<div id="showhint" class="tab-pane fade" role="tabpanel" aria-labelledby="showhint-tab">
<h4>
Total price
</h4>
<p>We need to do some serious multiplication. We now have the total amount shipped in pounds, and the price per pound, but we want to know the total price for each transaction.</p>
<p>How do we calculate that?</p>
<pre class="sourceCode r">
# Calculate the total price for each shipment
scrap <- scrap %>% 
         mutate(credits = total_pounds  * ________ )

</pre>
</div>
<div id="showcode" class="tab-pane fade" role="tabpanel" aria-labelledby="showcode-tab">
<h4>
Total price
</h4>
<p>We need to do some serious multiplication. We now have the total amount shipped in pounds, and the price per pound, but we want to know the total price for each transaction.</p>
<p>How do we calculate that?</p>
<pre class="sourceCode r">
# Calculate the total price for each shipment
scrap <- scrap %>% 
         mutate(credits = total_pounds * price_per_pound)
         
</pre>
</div>
</div>
</div>
<p><br></p>
</div>
<div id="price-per-item" class="section level2 unnumbered">
<h2>Price per item</h2>
<p><strong>Great!</strong> Let’s add one last column. We can divide the shipment’s <em>credits</em> by the <em>amount</em> of items to get the <code>price_per_unit</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Calculate the price per unit</span>
scrap &lt;-<span class="st"> </span>scrap <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">         </span><span class="kw">mutate</span>(<span class="dt">price_per_unit =</span> credits <span class="op">/</span><span class="st"> </span>amount)</code></pre></div>
<p><br></p>
<div class="note" style="line-height: 1.6;">
<p>Data analysts often get asked summary questions such as:</p>
<ul>
<li>What’s the highest or worst?</li>
<li>What’s the lowest number?</li>
<li>Is that worse than average?
<ul>
<li>What’s the average tonnage of scrap from Cratertown this year?</li>
</ul></li>
<li>What city is making the most money?</li>
</ul>
</div>
<div id="on-to-summarize" class="section level3 unnumbered">
<h3>On to <code>summarize()</code>!</h3>
</div>
</div>
</div>
<div id="summarize-this" class="section level1">
<h1><span class="header-section-number">5</span> | <code>summarize()</code> this!</h1>
<hr>
<div class="figure">
<img src="images/summarize_diagram.png" width="500" />

</div>
<p><code>summarize()</code> allows you to apply a summary function like <code>median()</code> to a column and collapse your data down to a single row. To really dig into <code>summarize</code> you’ll want to know some common summary functions, such as <code>sum()</code>, <code>mean()</code>, <code>median()</code>, <code>min()</code>, and <code>max()</code>.</p>
<div id="sum" class="section level2 unnumbered">
<h2><code>sum()</code></h2>
<p>Use <code>summarize()</code> and <code>sum()</code> to find the total credits of <strong>all</strong> the scrap.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarize</span>(scrap, <span class="dt">total_credits =</span> <span class="kw">sum</span>(credits))</code></pre></div>
</div>
<div id="mean" class="section level2 unnumbered">
<h2><code>mean()</code></h2>
<p>Use <code>summarize()</code> and <code>mean()</code> to calculate the <em>mean</em> <code>price_per_pound</code> in the scrap report.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarize</span>(scrap, <span class="dt">mean_price =</span> <span class="kw">mean</span>(price_per_pound, <span class="dt">na.rm =</span> T))</code></pre></div>
<p><br></p>
<div class="tip">
<p><br></p>
<p><strong>Note</strong> the <code>na.rm = TRUE</code> in the <code>mean()</code> function. This tells R to ignore empty cells or missing values that show up in R as <code>NA</code>. If you leave <code>na.rm</code> out, the <em>mean</em> function will return ‘NA’ if it finds a missing value in the data.</p>
</div>
</div>
<div id="median" class="section level2 unnumbered">
<h2><code>median()</code></h2>
<p>Use summarize to calculate the <em>median</em> price_per_pound in the scrap report.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarize</span>(scrap, <span class="dt">median_price =</span> <span class="kw">median</span>(price_per_pound, <span class="dt">na.rm =</span> T))</code></pre></div>
</div>
<div id="max" class="section level2 unnumbered">
<h2><code>max()</code></h2>
<p>Use summarize to calculate the <em>maximum</em> price per pound any scrapper got for their scrap.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarize</span>(scrap, <span class="dt">max_price =</span> <span class="kw">max</span>(price_per_pound, <span class="dt">na.rm =</span> T))</code></pre></div>
</div>
<div id="min" class="section level2 unnumbered">
<h2><code>min()</code></h2>
<p>Use summarize to calculate the <em>minimum</em> price per pound any scrapper got for their scrap.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarize</span>(scrap, <span class="dt">min_price =</span> <span class="kw">min</span>(price_per_pound, <span class="dt">na.rm =</span> T))</code></pre></div>
</div>
<div id="nth" class="section level2 unnumbered">
<h2><code>nth()</code></h2>
<p>Use <code>summarize()</code> and <code>nth(Origin, 12)</code> to find the name of the Origin City that had the <em>12th</em> highest scrapper haul.</p>
<p><em>Hint: Use <code>arrange()</code> first.</em></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(scrap, <span class="kw">desc</span>(credits)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">price_12 =</span> <span class="kw">nth</span>(origin, <span class="dv">12</span>))</code></pre></div>
</div>
<div id="quantile" class="section level2 unnumbered">
<h2><code>quantile()</code></h2>
<p>Quantiles are great for finding the upper or lower range of a column. Use the <code>quantile()</code> function to find the the 5th and 95th quantile of the prices.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarize</span>(scrap, 
          <span class="dt">price_5th_pctile  =</span> <span class="kw">quantile</span>(price_per_pound, <span class="fl">0.05</span>, <span class="dt">na.rm =</span> T),
          <span class="dt">price_95th_pctile =</span> <span class="kw">quantile</span>(price_per_pound, <span class="fl">0.95</span>))</code></pre></div>
<p><strong>Hint:</strong> Add <code>na.rm = T</code> to <code>quantile()</code>.</p>
<p><br></p>
<div class="tip">
<h3 id="exercise-2" class="unnumbered"><i class="fa fa-bicycle" aria-hidden="true" style="color: green"></i> EXERCISE</h3>
<p>Create a summary of the scrap data that includes 3 of the summary functions above. The following is one example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summary &lt;-<span class="st"> </span>scrap <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">             </span><span class="kw">summarize</span>(<span class="dt">max_credits      =</span>  __________ ,
                       <span class="dt">mean_credits     =</span>  __________ ,
                       <span class="dt">min_pounds       =</span>  __________  )</code></pre></div>
</div>
<p><br></p>
</div>
<div id="n" class="section level2 unnumbered">
<h2><code>n()</code></h2>
<p><code>n()</code> stands for <em>count</em>. It has the smallest function name I know of, but is super useful.</p>
<p>Use summarize and <code>n()</code> to count the number of reported scrap records going to <code>Niima outpost</code>.</p>
<p><br></p>
<p><strong>Hint:</strong> Use <code>filter()</code> first.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">niima_scrap &lt;-<span class="st"> </span><span class="kw">filter</span>(scrap, destination <span class="op">==</span><span class="st"> &quot;Niima Outpost&quot;</span>) </code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">niima_scrap &lt;-<span class="st"> </span><span class="kw">summarize</span>(niima_scrap, <span class="dt">scrap_records =</span> <span class="kw">n</span>())</code></pre></div>
<p><br></p>
<p>Ok. That was fun. Now let’s do a summary for Cratertown. And then for Blowback Town. And then for Tuanul. And then for…</p>
<p><br></p>
<div id="wait" class="section level3 unnumbered">
<h3><strong>Wait!</strong></h3>
<blockquote>
<p>Do we really need to <code>filter</code> to the <em>origin</em> city that we’re interested in every single time?</p>
<p>How about you just give me the mean price for every <em>origin</em> city. Then I could use that to answer a question about any city I want.</p>
<p>Okay. Fine. It’s time we talk about <strong><code>group_by()</code>.</strong></p>
</blockquote>
</div>
</div>
</div>
<div id="group_by" class="section level1">
<h1><span class="header-section-number">6</span> | <code>group_by()</code></h1>
<hr>
<div id="the-junk-capital-of-jakku" class="section level2 unnumbered">
<h2>The junk Capital of Jakku</h2>
<blockquote>
<p>Which origin city had the most shipments of junk?</p>
</blockquote>
<p><br></p>
<p>Use <code>group_by</code> with the column <em>origin</em>, and then use<code>summarize</code> to count the <strong>number</strong> of records at each origin city.</p>
<p><br></p>
<p><strong>Fill in the blank</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scrap_shipments &lt;-<span class="st"> </span><span class="kw">group_by</span>(scrap, ______ ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                     </span><span class="kw">summarize</span>(<span class="dt">shipments =</span>  ______ ) </code></pre></div>
<details> <summary class = "btn_code"><em>Show code</em></summary>
<p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scrap_shipments &lt;-<span class="st"> </span><span class="kw">group_by</span>(scrap, origin ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                     </span><span class="kw">summarize</span>(<span class="dt">shipments =</span>  <span class="kw">n</span>() ) </code></pre></div>
</p>
<p></details></p>
<div class="quiz">
<h3 id="pop-quiz" class="unnumbered">Pop Quiz!</h3>
<p><strong>Which city had the most scrap shipments?</strong></p>
<p><input type="radio"> <em>Tuanul</em> <br> <input type="radio"> <em>Outskirts</em> <br> <input type="radio"> <em>Reestki</em> <br> <input type="radio"> <em>Cratertown</em> <br> <br></p>
<p><details> <summary class = "btn_code"><em>Show solution</em></summary></p>
<p>
<p><i class="fa fa-check" aria-hidden="true" style="color: green;"></i> <code>Cratertown</code></p>
<p><em>You’ve got the POWER!</em></p>
</p>
</details>
</div>
</div>
<div id="bargain-hunters" class="section level2 unnumbered">
<h2>Bargain hunters</h2>
<p>Who’s selling goods for cheap?</p>
<p>Use <code>group_by</code> with the column <em>origin</em>, and then use<code>summarize</code> to find the <code>mean(price_per_unit)</code> at each origin city.</p>
<details> <summary class = "btn_code"><em>Show code</em></summary>
<p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mean_prices &lt;-<span class="st"> </span><span class="kw">group_by</span>(scrap, origin) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                 </span><span class="kw">summarize</span>(<span class="dt">mean_price =</span> <span class="kw">mean</span>(price_per_unit, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span>
<span class="st">                 </span><span class="kw">ungroup</span>()</code></pre></div>
</p>
<p></details></p>
<p><br></p>
<p><details> <summary class="btn_code_blue"> EXPLORE: Rounding digits </summary></p>
<div class="note" style="margin-top: -9px;">
<p>
<p>You can round the prices to a certain number of digits using the <code>round()</code> function. We can finish by adding the <code>arrange()</code> function to sort the table by our new column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mean_prices &lt;-<span class="st"> </span><span class="kw">group_by</span>(scrap, origin) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                 </span><span class="kw">summarize</span>(<span class="dt">mean_price       =</span> <span class="kw">mean</span>(price_per_unit, <span class="dt">na.rm =</span> T),
                           <span class="dt">mean_price_round =</span> <span class="kw">round</span>(mean_price, <span class="dt">digits =</span> <span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">                 </span><span class="kw">arrange</span>(mean_price_round) <span class="op">%&gt;%</span>
<span class="st">                 </span><span class="kw">ungroup</span>()</code></pre></div>
<p><br></p>
</p>
</div>
<p></details></p>
<p><br></p>
<div class="well">
<h3 id="pro-tip" class="unnumbered"><i class="fa fa-user-astronaut" aria-hidden="true" style="color:#040707;"></i> Pro-tip!</h3>
<p>Ending with <code>ungroup()</code> is good practice. This prevents your data from staying grouped after the summarizing has been completed.</p>
</div>
</div>
</div>
<div id="save-files" class="section level1">
<h1><span class="header-section-number">7</span> | Save files</h1>
<hr>
<p>Let’s save the mean price summary table we created to a <em>CSV</em>. That way we can transfer it to a <em>droid courier</em> for delivery to Rey. To save a data frame we use the <code>write_csv()</code> function from our favorite <code>readr</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Write the file to your results folder</span>
<span class="kw">write_csv</span>(mean_prices, <span class="st">&quot;results/prices_by_origin.csv&quot;</span>)</code></pre></div>
<p><br></p>
<div class="red-note">
<h5 id="warning" class="unnumbered"><i class="fas fa-exclamation-triangle" style="color: #040707;"></i> <strong>WARNING!</strong></h5>
<p>By default, when saving files R will overwrite a file if the file already exists in the same folder. It will not ask for confirmation. To be safe, save processed data to a new folder called <code>results/</code> and not to your raw <code>data/</code> folder.</p>
</div>
<p><br></p>
</div>
<div id="return-to-homebase" class="section level1 unnumbered">
<h1><i class="fa fa-rocket" aria-hidden="true"></i> Return to <a href="index.html">Homebase</a></h1>
<p><br></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
